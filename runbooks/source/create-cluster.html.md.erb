---
title: Create a new cluster
weight: 50
last_reviewed_on: 2019-09-10
review_in: 3 months
---

# Create a new cluster

## Pre-requisites

Before you begin, there are a few pre-requisites:

- Your GPG key must be added to the [infrastructure repo] so that you are able to run `git-crypt unlock` (the script will run this for you, but you must be *able* to do it)

- You have [AWS CLI] profiles `moj-cp` and `moj-dsd` with suitable credentials

- You have [docker] installed

## Environment Variables

See the file `example.env.create-cluster` in the [infrastructure repo]. This shows examples of the environment variables which must be set in order to run the `create-cluster.rb` script to create a new cluster.

You can get the auth0 values from the `terraform-provider-auth0` application on [auth0](https://manage.auth0.com/#/applications).

## Run the build script, via the tools image

The cloud platform [tools image] has all the software required to run the build script and create a cluster.

NB: The build script will change your working copy of `terraform/cloud-platform-components/terraform.tfvars` file to prevent your test cluster sending `high-priority pagerduty alarms` and `low-priority slack alerts` to the team slack channels.

Start from the root directory of a working copy of the [infrastructure repo].

With your environment variables set, launch a bash shell on the tools image:

```bash
make tools-shell
```

Execute the script, supplying the desired name of your new cluster. e.g.:

```bash
./create-cluster.rb david-test1
```

NB: Your cluster name must be **no more than 12 characters**. Any longer, and some of the computed strings which include the cluster name will exceed their maximum allowed values. The error messages you get if this happens are unhelpful. In order to prevent this, the build script will fail immediately if you supply a name which is too long.

See our [cluster naming policy] for information on how to choose a suitable name for your cluster.

The script takes around 30 minutes to execute. At the end, you should see output like this:

```
Kubernetes master is running at https://api.david-test1.cloud-platform.service.justice.gov.uk
KubeDNS is running at https://api.david-test1.cloud-platform.service.justice.gov.uk/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
``` 

[infrastructure repo]: https://github.com/ministryofjustice/cloud-platform-infrastructure
[cluster naming policy]: https://github.com/ministryofjustice/cloud-platform/blob/master/architecture-decision-record/009-Naming-convention-for-clusters.md
[AWS CLI]: https://aws.amazon.com/cli/
[docker]: https://www.docker.com/
[PagerDuty]: https://www.pagerduty.com/
[tools image]: https://github.com/ministryofjustice/cloud-platform-tools-image
