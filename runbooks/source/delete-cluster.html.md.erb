---
title: Delete a cluster
weight: 55
last_reviewed_on: 2023-08-25
review_in: 6 months
---

# Delete a cluster

It is recommended to pass responsibility for deleting a test cluster off to concourse. It's easy to make a mistake locally and end up deleting something you shouldn't e.g. switching context to live whilst running a delete cluster in another terminal

## Delete the cluster using concourse fly commands

In case you prefer concourse pipeline to destroy the cluster, these are the steps to follow, to delete the cluster using "concourse fly commands"

Run the below commands updating the `<cluster-name-to-be-deleted>`. The second fly command will set the `cluster_name` [static var][concourse-static-vars], the third command will trigger the delete-cluster job using the `cluster_name` provided.

from the root dir of `cloud-platform-terraform-concourse`:

```
fly --target manager login --team-name main --concourse-url https://concourse.cloud-platform.service.justice.gov.uk/
fly -t manager set-pipeline -p delete-cluster -c pipelines/manager/main/delete-cluster.yaml -v cluster_name=<cluster-name-to-be-deleted>
# -w flag is optional and allows user to watch the output from the concourse job
fly -t manager trigger-job -j delete-cluster/delete -w
```

## Delete the cluster locally, using the cli command

To delete a cluster:

```
$ export AWS_PROFILE=moj-cp
```

Start from the root directory of a working copy of the [infrastructure repo].

There is a [delete-cluster command] which will handle deleting your cluster.

The command is entirely non-interactive, and will not prompt you to confirm anything. It just destroys things.

### First, run `make tools-shell`

> The delete cluster command must *always* be run in a container. This ensures that the environment of the command is fully controlled, and you don't run into problems such as the kubernetes context being changed in another window, or extra environment variables causing unwanted effects.

Then invoke the command like this:

```
cloud-platform cluster delete --name <cluster-nameto-be-deleted> --dry-run=false
```

Run with `--dry-run=true` to do a dry run (if you don't pass a flag it will default to true), and see what commands would be executed.

You can get more information using:

```
cloud-platform cluster delete --help
```

If any steps fail:

* Fix the underlying problem
* Re-run the command

## Delete an EKS cluster manually

The steps can be found here - [Delete an EKS Cluster]

[infrastructure repo]: https://github.com/ministryofjustice/cloud-platform-infrastructure
[delete-cluster command]: https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/destroy-cluster.rb
[pipelines repo]: https://github.com/ministryofjustice/cloud-platform-terraform-concourse/tree/main/pipelines/manager/main
[concourse-vars]: https://concourse-ci.org/vars.html#var-syntax
[concourse-static-vars]: https://concourse-ci.org/vars.html#static-vars
[Delete an EKS Cluster]: eks-cluster.html#4-delete-the-eks-cluster
